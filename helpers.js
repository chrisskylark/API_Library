"use strict";
var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.getConfig = exports.gatewayevent = exports.injectDate = exports.shortMonthName = exports.monthName = exports.decodeBody = exports.getDistanceFromLatLonInKm = exports.sendMessage = exports.getMgmt = exports.currentConfig = exports.calculateAge = exports.spliceString = exports.hasAllKeys = exports.uuidv4 = exports.zeroPad = exports.daysBetween = exports.minutesFromDuration = exports.tryParse = exports.randomInt = exports.randomDate = exports.disconnectMySQL = exports.getMySQLClient = exports.lambda = void 0;
const AWS = __importStar(require("aws-sdk"));
const _ = __importStar(require("lodash"));
const crypto = __importStar(require("crypto"));
const getConfig_1 = require("./getConfig");
Object.defineProperty(exports, "getConfig", { enumerable: true, get: function () { return getConfig_1.getConfig; } });
const mysql = __importStar(require("mysql2/promise"));
let apigwManagementApi = null;
exports.lambda = new AWS.Lambda();
let MYSQL = null;
async function getMySQLClient() {
    if (MYSQL)
        return MYSQL;
    const config = await (0, getConfig_1.getConfig)();
    if (!config || !config.mysql)
        throw new Error('Config/MySQL Config could not be retrieved');
    try {
        MYSQL = await mysql.createConnection(config.mysql);
        await MYSQL.connect();
        return MYSQL;
    }
    catch (error) {
        console.error('Cannot connect to MySQL server ', error);
    }
    return null;
}
exports.getMySQLClient = getMySQLClient;
async function disconnectMySQL() {
    if (MYSQL && MYSQL)
        await MYSQL.end();
    MYSQL = null;
    return true;
}
exports.disconnectMySQL = disconnectMySQL;
function randomDate(start, end) {
    end = end || new Date();
    return new Date(start.getTime() + Math.random() * (end.getTime() - start.getTime()));
}
exports.randomDate = randomDate;
function randomInt(min, max) {
    return crypto.randomInt(min, max);
}
exports.randomInt = randomInt;
function tryParse(json) {
    try {
        return JSON.parse(json);
    }
    catch (e) {
        return {};
    }
}
exports.tryParse = tryParse;
function minutesFromDuration(duration) {
    let stages;
    if (duration.includes(':')) {
        stages = duration.split(':');
        if (stages.length == 0) {
            stages = '1:00:00'.split(':');
        }
        else if (stages.length > 2) {
            stages = 60 * stages[0] + stages[1] * 1;
        }
        else if ((stages.length = 2)) {
            stages = 1 * stages[0];
        }
        if (isNaN(stages) || stages < 10)
            stages = 60;
    }
    else {
        stages = Number.parseInt(duration);
        if (_.isNaN(stages))
            stages = 60;
    }
    return stages;
}
exports.minutesFromDuration = minutesFromDuration;
function daysBetween(firstDate, secondDate) {
    const oneDay = 24 * 60 * 60 * 1000;
    const diffDays = Math.round(Math.abs((firstDate.getTime() - secondDate.getTime()) / oneDay));
    return diffDays;
}
exports.daysBetween = daysBetween;
function zeroPad(num, places) {
    return String(num).padStart(places, '0');
}
exports.zeroPad = zeroPad;
function uuidv4() {
    return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function (c) {
        var r = (Math.random() * 16) | 0, v = c == 'x' ? r : (r & 0x3) | 0x8;
        return v.toString(16);
    });
}
exports.uuidv4 = uuidv4;
function hasAllKeys(obj, keys) {
    let has = true;
    keys.forEach((k) => {
        has = has && Object.prototype.hasOwnProperty.call(obj, k);
    });
    return has;
}
exports.hasAllKeys = hasAllKeys;
function spliceString(string, index, count = 0, insert = '') {
    const array = _.toArray(string);
    array.splice(index, count, insert);
    return array.join('');
}
exports.spliceString = spliceString;
function calculateAge(birthday) {
    var ageDifMs = Date.now() - birthday.getTime();
    var ageDate = new Date(ageDifMs);
    return Math.abs(ageDate.getUTCFullYear() - 1970);
}
exports.calculateAge = calculateAge;
async function currentConfig() {
    let config = await (0, getConfig_1.getConfig)();
    return config;
}
exports.currentConfig = currentConfig;
function getMgmt(event) {
    if (apigwManagementApi)
        return apigwManagementApi;
    apigwManagementApi = new AWS.ApiGatewayManagementApi({
        apiVersion: '2018-11-29',
        endpoint: event.requestContext.domainName + '/' + event.requestContext.stage,
    });
    return apigwManagementApi;
}
exports.getMgmt = getMgmt;
async function sendMessage(to, action, data) {
    data.action = action;
    try {
        if (apigwManagementApi) {
            await apigwManagementApi
                .postToConnection({
                ConnectionId: to,
                Data: JSON.stringify(data),
            })
                .promise();
            return true;
        }
        return false;
    }
    catch (e) {
        console.log('Error sending message ', e);
        return false;
    }
}
exports.sendMessage = sendMessage;
function getDistanceFromLatLonInKm(lat1, lon1, lat2, lon2) {
    var R = 6371;
    var dLat = deg2rad(lat2 - lat1);
    var dLon = deg2rad(lon2 - lon1);
    var a = Math.sin(dLat / 2) * Math.sin(dLat / 2) +
        Math.cos(deg2rad(lat1)) * Math.cos(deg2rad(lat2)) * Math.sin(dLon / 2) * Math.sin(dLon / 2);
    var c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));
    var d = R * c;
    return d;
}
exports.getDistanceFromLatLonInKm = getDistanceFromLatLonInKm;
function deg2rad(deg) {
    return deg * (Math.PI / 180);
}
function decodeBody(event) {
    let bodyRaw = event.body;
    let body = event.body;
    let bodyJSON;
    if (event.isBase64Encoded) {
        body = Buffer.from(bodyRaw, 'base64').toString('utf8');
    }
    try {
        bodyJSON = JSON.parse(body);
        return bodyJSON;
    }
    catch (_a) {
        return body;
    }
}
exports.decodeBody = decodeBody;
function monthName(month) {
    let months = [
        'January',
        'February',
        'March',
        'April',
        'May',
        'June',
        'July',
        'August',
        'September',
        'October',
        'November',
        'December',
    ];
    if (month < 0 || month > 11)
        throw new Error('Invalid month number');
    return months[month];
}
exports.monthName = monthName;
function shortMonthName(month) {
    return monthName(month).substring(0, 3).toUpperCase();
}
exports.shortMonthName = shortMonthName;
function injectDate(text) {
    function pad(n) {
        return n < 10 ? '0' + n : '' + n;
    }
    let timeNow = new Date();
    text = text.replace(/%sm/g, shortMonthName(timeNow.getMonth()));
    text = text.replace(/%lm/g, monthName(timeNow.getMonth()));
    text = text.replace(/%d/g, pad(timeNow.getDate()));
    text = text.replace(/%m/g, pad(timeNow.getMonth() + 1));
    text = text.replace(/%y/g, pad(timeNow.getFullYear()));
    text = text.replace(/%h/g, pad(timeNow.getHours()));
    text = text.replace(/%n/g, pad(timeNow.getMinutes()));
    text = text.replace(/%s/g, pad(timeNow.getSeconds()));
    text = text.replace(/%l/g, pad(timeNow.getMilliseconds()));
    return text;
}
exports.injectDate = injectDate;
exports.gatewayevent = {
    version: '2.0',
    rawQueryString: '',
    headers: {
        accept: '*/*',
        'accept-encoding': 'gzip,deflate,br',
        authorization: 'Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6MTg4OCwiaWF0IjoxNjM1NDMyMzQxLCJleHAiOjE2MzgwMjQzNDF9.Y0aEY5UZ6hJJfK9xqqEWwHr84BM8jzqJ1Paw6zzu9Gg',
        'content-length': '885',
        'content-type': 'application/jwt',
        host: '1db5wfkr9g.execute-api.eu-west-2.amazonaws.com',
        'user-agent': 'node-fetch',
        'x-amzn-trace-id': 'Root=1-617abd04-2a68e8cf0bbff9a44cf9c811',
        'x-forwarded-for': '82.31.1.88',
        'x-forwarded-port': '443',
        'x-forwarded-proto': 'https',
    },
    requestContext: {
        accountId: '072444354828',
        apiId: '1db5wfkr9g',
        domainName: '1db5wfkr9g.execute-api.eu-west-2.amazonaws.com',
        domainPrefix: '1db5wfkr9g',
        http: {
            method: 'POST',
            path: '/dev/coins/purchase',
            protocol: 'HTTP/1.1',
            sourceIp: '82.31.1.88',
            userAgent: 'node-fetch',
        },
        stage: 'dev',
        time: '28/Oct/2021:15:08:52 +0000',
        timeEpoch: 1635433732997,
    },
    body: '',
    isBase64Encoded: false,
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaGVscGVycy5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbImhlbHBlcnMudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUFBLDZDQUErQjtBQUMvQiwwQ0FBNEI7QUFDNUIsK0NBQWlDO0FBRWpDLDJDQUFrRDtBQW1UMUMsMEZBblRZLHFCQUFTLE9BbVRaO0FBaFRqQixzREFBd0M7QUFDeEMsSUFBSSxrQkFBa0IsR0FBdUMsSUFBSSxDQUFDO0FBU3JELFFBQUEsTUFBTSxHQUFHLElBQUksR0FBRyxDQUFDLE1BQU0sRUFBRSxDQUFDO0FBRXZDLElBQUksS0FBSyxHQUE0QixJQUFJLENBQUM7QUEwQ25DLEtBQUssVUFBVSxjQUFjO0lBQ2xDLElBQUksS0FBSztRQUFFLE9BQU8sS0FBSyxDQUFDO0lBQ3hCLE1BQU0sTUFBTSxHQUFHLE1BQU0sSUFBQSxxQkFBUyxHQUFFLENBQUM7SUFDakMsSUFBSSxDQUFDLE1BQU0sSUFBSSxDQUFDLE1BQU0sQ0FBQyxLQUFLO1FBQUUsTUFBTSxJQUFJLEtBQUssQ0FBQyw0Q0FBNEMsQ0FBQyxDQUFDO0lBQzVGLElBQUk7UUFDRixLQUFLLEdBQUcsTUFBTSxLQUFLLENBQUMsZ0JBQWdCLENBQUMsTUFBTSxDQUFDLEtBQUssQ0FBQyxDQUFDO1FBQ25ELE1BQU0sS0FBSyxDQUFDLE9BQU8sRUFBRSxDQUFDO1FBQ3RCLE9BQU8sS0FBSyxDQUFDO0tBQ2Q7SUFBQyxPQUFPLEtBQUssRUFBRTtRQUNkLE9BQU8sQ0FBQyxLQUFLLENBQUMsaUNBQWlDLEVBQUUsS0FBSyxDQUFDLENBQUM7S0FDekQ7SUFDRCxPQUFPLElBQUksQ0FBQztBQUNkLENBQUM7QUFaRCx3Q0FZQztBQUNNLEtBQUssVUFBVSxlQUFlO0lBQ25DLElBQUksS0FBSyxJQUFJLEtBQUs7UUFBRSxNQUFNLEtBQUssQ0FBQyxHQUFHLEVBQUUsQ0FBQztJQUN0QyxLQUFLLEdBQUcsSUFBSSxDQUFDO0lBQ2IsT0FBTyxJQUFJ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Q0FBQztBQUNkLENBQUM7QUFoQkQsZ0NBZ0JDO0FBRVksUUFBQSxZQUFZLEdBQUc7SUFDMUIsT0FBTyxFQUFFLEtBQUs7SUFDZCxjQUFjLEVBQUUsRUFBRTtJQUNsQixPQUFPLEVBQUU7UUFDUCxNQUFNLEVBQUUsS0FBSztRQUNiLGlCQUFpQixFQUFFLGlCQUFpQjtRQUNwQyxhQUFhLEVBQ1gsc0pBQXNKO1FBQ3hKLGdCQUFnQixFQUFFLEtBQUs7UUFDdkIsY0FBYyxFQUFFLGlCQUFpQjtRQUNqQyxJQUFJLEVBQUUsZ0RBQWdEO1FBQ3RELFlBQVksRUFBRSxZQUFZO1FBQzFCLGlCQUFpQixFQUFFLDBDQUEwQztRQUM3RCxpQkFBaUIsRUFBRSxZQUFZO1FBQy9CLGtCQUFrQixFQUFFLEtBQUs7UUFDekIsbUJBQW1CLEVBQUUsT0FBTztLQUM3QjtJQUNELGNBQWMsRUFBRTtRQUNkLFNBQVMsRUFBRSxjQUFjO1FBQ3pCLEtBQUssRUFBRSxZQUFZO1FBQ25CLFVBQVUsRUFBRSxnREFBZ0Q7UUFDNUQsWUFBWSxFQUFFLFlBQVk7UUFDMUIsSUFBSSxFQUFFO1lBQ0osTUFBTSxFQUFFLE1BQU07WUFDZCxJQUFJLEVBQUUscUJBQXFCO1lBQzNCLFFBQVEsRUFBRSxVQUFVO1lBQ3BCLFFBQVEsRUFBRSxZQUFZO1lBQ3RCLFNBQVMsRUFBRSxZQUFZO1NBQ3hCO1FBQ0QsS0FBSyxFQUFFLEtBQUs7UUFDWixJQUFJLEVBQUUsNEJBQTRCO1FBQ2xDLFNBQVMsRUFBRSxhQUFhO0tBQ3pCO0lBQ0QsSUFBSSxFQUFFLEVBQUU7SUFDUixlQUFlLEVBQUUsS0FBSztDQUN2QixDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0ICogYXMgQVdTIGZyb20gJ2F3cy1zZGsnO1xuaW1wb3J0ICogYXMgXyBmcm9tICdsb2Rhc2gnO1xuaW1wb3J0ICogYXMgY3J5cHRvIGZyb20gJ2NyeXB0byc7XG4vLyBpbXBvcnQgKiBhcyBzZWNyZXRzIGZyb20gJy4vLnNlY3JldHMuanNvbic7XG5pbXBvcnQge0NvbmZpZ0RhdGEsIGdldENvbmZpZ30gZnJvbSAnLi9nZXRDb25maWcnO1xuLy8gaW1wb3J0IHtPYmplY3RJZCwgY29ubmVjdE1vbmdvLCBTdG9yZVR5cGV9IGZyb20gJy4vZ2V0TW9uZ29DbGllbnQnO1xuLy8gaW1wb3J0IHtEYn0gZnJvbSAnbW9uZ29kYic7XG5pbXBvcnQgKiBhcyBteXNxbCBmcm9tICdteXNxbDIvcHJvbWlzZSc7XG5sZXQgYXBpZ3dNYW5hZ2VtZW50QXBpOiBBV1MuQXBpR2F0ZXdheU1hbmFnZW1lbnRBcGkgfCBudWxsID0gbnVsbDtcbi8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4vLyDwn5Ob8J+Tm/Cfk5vwn5Ob8J+Tm/Cfk5vwn5Ob8J+Tm/Cfk5vwn5Ob8J+Tm/Cfk5vwn5Ob8J+Tm/Cfk5vwn5Ob8J+Tm/Cfk5vwn5Ob8J+Tm/Cfk5vwn5Ob8J+Tm/Cfk5vwn5Ob8J+Tm/Cfk5vwn5Ob8J+Tm/Cfk5tcbi8vIFJFTU9WRSBkeW5hbW9Db25maWcgYmVmb3JlIGdvaW5nIGxpdmVcbi8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4vLyBleHBvcnQgY29uc3QgbGFtYmRhID0gbmV3IEFXUy5MYW1iZGEoc2VjcmV0cyk7XG4vLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuLy8g8J+Tm/Cfk5vwn5Ob8J+Tm/Cfk5vwn5Ob8J+Tm/Cfk5vwn5Ob8J+Tm/Cfk5vwn5Ob8J+Tm/Cfk5vwn5Ob8J+Tm/Cfk5vwn5Ob8J+Tm/Cfk5vwn5Ob8J+Tm/Cfk5vwn5Ob8J+Tm/Cfk5vwn5Ob8J+Tm/Cfk5vwn5ObXG4vLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuZXhwb3J0IGNvbnN0IGxhbWJkYSA9IG5ldyBBV1MuTGFtYmRhKCk7XG4vLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxubGV0IE1ZU1FMOiBteXNxbC5Db25uZWN0aW9uIHwgbnVsbCA9IG51bGw7XG4vLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuLy8g4pWmIOKVpuKVlOKVkOKVl+KVpiAg4pWU4pWQ4pWX4pWU4pWQ4pWX4pWm4pWQ4pWX4pWU4pWQ4pWXXG4vLyDilaDilZDilaPilZHilaMg4pWRICDilaDilZDilZ3ilZHilaMg4pWg4pWm4pWd4pWa4pWQ4pWXXG4vLyDilakg4pWp4pWa4pWQ4pWd4pWp4pWQ4pWd4pWpICDilZrilZDilZ3ilanilZrilZDilZrilZDilZ1cbi8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG5cbi8qKlxuICogU2V0cyB1cCB0aGUgYXBpZ3dNYW5hZ2VtZW50QXBpIHNlcnZpY2VcbiAqIEBwYXJhbSB7Kn0gZXZlbnRcbiAqIEByZXR1cm5zIC0gYXBpZ3dNYW5hZ2VtZW50QXBpIHNlcnZpY2VcbiAqL1xuXG4vLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuXG4vLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuLy8g4pWU4pWm4pWX4pSM4pSA4pSQ4pSM4pSQ4pSM4pSM4pSA4pSQ4pSM4pSA4pSQ4pWU4pWm4pWX4pWU4pWXXG4vLyDilZHilZHilZHilIIg4pSC4pSC4pSC4pSC4pSCIOKUrOKUgiDilIIg4pWR4pWR4pWg4pWp4pWXXG4vLyDilakg4pWp4pSU4pSA4pSY4pSY4pSU4pSY4pSU4pSA4pSY4pSU4pSA4pSY4pWQ4pWp4pWd4pWa4pWQ4pWdXG4vLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuLypcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBnZXRNb25nb0NsaWVudCgpIHtcbiAgY29uc3QgY29uZmlnID0gYXdhaXQgZ2V0Q29uZmlnKCk7XG4gIGlmICghY29uZmlnKSB0aHJvdyBuZXcgRXJyb3IoJ0NvbmZpZyBjb3VsZCBub3QgYmUgcmV0cmlldmVkJyk7XG4gIGNvbnN0IGNsaWVudCA9IGF3YWl0IGNvbm5lY3RNb25nbyg8c3RyaW5nPmNvbmZpZy5tb25nb1VSSSk7XG4gIHJldHVybiBjbGllbnQ7XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBnZXRNb25nb0RCKCk6IFByb21pc2U8RGIgfCB1bmRlZmluZWQ+IHtcbiAgY29uc3QgY29uZmlnID0gYXdhaXQgZ2V0Q29uZmlnKCk7XG4gIGNvbnN0IGNsaWVudCA9IGF3YWl0IGdldE1vbmdvQ2xpZW50KCk7XG4gIGNvbnN0IERCID0gY2xpZW50Py5kYihjb25maWc/Lm1vbmdvREIpO1xuICByZXR1cm4gREI7XG59XG4qL1xuLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cblxuLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbi8vIOKVlOKVpuKVl+KUrCDilKzilZTilZDilZfilZTilZDilZcg4pWmXG4vLyDilZHilZHilZHilJTilKzilJjilZrilZDilZfilZHilZDilazilZfilZFcbi8vIOKVqSDilakg4pS0IOKVmuKVkOKVneKVmuKVkOKVneKVmuKVqeKVkOKVnVxuLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBnZXRNeVNRTENsaWVudCgpOiBQcm9taXNlPG15c3FsLkNvbm5lY3Rpb24gfCBudWxsPiB7XG4gIGlmIChNWVNRTCkgcmV0dXJuIE1ZU1FMO1xuICBjb25zdCBjb25maWcgPSBhd2FpdCBnZXRDb25maWcoKTtcbiAgaWYgKCFjb25maWcgfHwgIWNvbmZpZy5teXNxbCkgdGhyb3cgbmV3IEVycm9yKCdDb25maWcvTXlTUUwgQ29uZmlnIGNvdWxkIG5vdCBiZSByZXRyaWV2ZWQnKTtcbiAgdHJ5IHtcbiAgICBNWVNRTCA9IGF3YWl0IG15c3FsLmNyZWF0ZUNvbm5lY3Rpb24oY29uZmlnLm15c3FsKTtcbiAgICBhd2FpdCBNWVNRTC5jb25uZWN0KCk7XG4gICAgcmV0dXJuIE1ZU1FMO1xuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUuZXJyb3IoJ0Nhbm5vdCBjb25uZWN0IHRvIE15U1FMIHNlcnZlciAnLCBlcnJvcik7XG4gIH1cbiAgcmV0dXJuIG51bGw7XG59XG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZGlzY29ubmVjdE15U1FMKCk6IFByb21pc2U8Ym9vbGVhbj4ge1xuICBpZiAoTVlTUUwgJiYgTVlTUUwpIGF3YWl0IE1ZU1FMLmVuZCgpO1xuICBNWVNRTCA9IG51bGw7XG4gIHJldHVybiB0cnVlO1xufVxuXG4vLyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuXG5leHBvcnQgZnVuY3Rpb24gcmFuZG9tRGF0ZShzdGFydDogRGF0ZSwgZW5kPzogRGF0ZSk6IERhdGUge1xuICBlbmQgPSBlbmQgfHwgbmV3IERhdGUoKTtcbiAgcmV0dXJuIG5ldyBEYXRlKHN0YXJ0LmdldFRpbWUoKSArIE1hdGgucmFuZG9tKCkgKiAoZW5kLmdldFRpbWUoKSAtIHN0YXJ0LmdldFRpbWUoKSkpO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gcmFuZG9tSW50KG1pbjogbnVtYmVyLCBtYXg6IG51bWJlcik6IG51bWJlciB7XG4gIHJldHVybiBjcnlwdG8ucmFuZG9tSW50KG1pbiwgbWF4KTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIHRyeVBhcnNlKGpzb246IHN0cmluZyk6IG9iamVjdCB7XG4gIHRyeSB7XG4gICAgcmV0dXJuIEpTT04ucGFyc2UoanNvbik7XG4gIH0gY2F0Y2ggKGUpIHtcbiAgICByZXR1cm4ge307XG4gIH1cbn1cblxuZXhwb3J0IGZ1bmN0aW9uIG1pbnV0ZXNGcm9tRHVyYXRpb24oZHVyYXRpb246IHN0cmluZyk6IG51bWJlciB7XG4gIGxldCBzdGFnZXM6IGFueTtcbiAgaWYgKGR1cmF0aW9uLmluY2x1ZGVzKCc6JykpIHtcbiAgICBzdGFnZXMgPSBkdXJhdGlvbi5zcGxpdCgnOicpO1xuICAgIGlmIChzdGFnZXMubGVuZ3RoID09IDApIHtcbiAgICAgIHN0YWdlcyA9ICcxOjAwOjAwJy5zcGxpdCgnOicpO1xuICAgIH0gZWxzZSBpZiAoc3RhZ2VzLmxlbmd0aCA+IDIpIHtcbiAgICAgIHN0YWdlcyA9IDYwICogc3RhZ2VzWzBdICsgc3RhZ2VzWzFdICogMTtcbiAgICB9IGVsc2UgaWYgKChzdGFnZXMubGVuZ3RoID0gMikpIHtcbiAgICAgIHN0YWdlcyA9IDEgKiBzdGFnZXNbMF07XG4gICAgfVxuXG4gICAgaWYgKGlzTmFOKHN0YWdlcykgfHwgc3RhZ2VzIDwgMTApIHN0YWdlcyA9IDYwO1xuICB9IGVsc2Uge1xuICAgIHN0YWdlcyA9IE51bWJlci5wYXJzZUludChkdXJhdGlvbik7XG4gICAgaWYgKF8uaXNOYU4oc3RhZ2VzKSkgc3RhZ2VzID0gNjA7XG4gIH1cblxuICByZXR1cm4gc3RhZ2VzO1xufVxuZXhwb3J0IGZ1bmN0aW9uIGRheXNCZXR3ZWVuKGZpcnN0RGF0ZTogRGF0ZSwgc2Vjb25kRGF0ZTogRGF0ZSk6IG51bWJlciB7XG4gIGNvbnN0IG9uZURheSA9IDI0ICogNjAgKiA2MCAqIDEwMDA7IC8vIGhvdXJzKm1pbnV0ZXMqc2Vjb25kcyptaWxsaXNlY29uZHNcbiAgY29uc3QgZGlmZkRheXMgPSBNYXRoLnJvdW5kKE1hdGguYWJzKChmaXJzdERhdGUuZ2V0VGltZSgpIC0gc2Vjb25kRGF0ZS5nZXRUaW1lKCkpIC8gb25lRGF5KSk7XG4gIHJldHVybiBkaWZmRGF5cztcbn1cbmV4cG9ydCBmdW5jdGlvbiB6ZXJvUGFkKG51bTogbnVtYmVyLCBwbGFjZXM6IG51bWJlcik6IHN0cmluZyB7XG4gIHJldHVybiBTdHJpbmcobnVtKS5wYWRTdGFydChwbGFjZXMsICcwJyk7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiB1dWlkdjQoKSB7XG4gIHJldHVybiAneHh4eHh4eHgteHh4eC00eHh4LXl4eHgteHh4eHh4eHh4eHh4Jy5yZXBsYWNlKC9beHldL2csIGZ1bmN0aW9uIChjKSB7XG4gICAgdmFyIHIgPSAoTWF0aC5yYW5kb20oKSAqIDE2KSB8IDAsXG4gICAgICB2ID0gYyA9PSAneCcgPyByIDogKHIgJiAweDMpIHwgMHg4O1xuICAgIHJldHVybiB2LnRvU3RyaW5nKDE2KTtcbiAgfSk7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBoYXNBbGxLZXlzKG9iajogb2JqZWN0LCBrZXlzOiBzdHJpbmdbXSk6IGJvb2xlYW4ge1xuICBsZXQgaGFzID0gdHJ1ZTtcbiAga2V5cy5mb3JFYWNoKChrOiBzdHJpbmcpID0+IHtcbiAgICBoYXMgPSBoYXMgJiYgT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKG9iaiwgayk7XG4gIH0pO1xuICByZXR1cm4gaGFzO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gc3BsaWNlU3RyaW5nKHN0cmluZzogc3RyaW5nLCBpbmRleDogbnVtYmVyLCBjb3VudDogbnVtYmVyID0gMCwgaW5zZXJ0OiBzdHJpbmcgPSAnJyk6IHN0cmluZyB7XG4gIGNvbnN0IGFycmF5ID0gXy50b0FycmF5KHN0cmluZyk7XG4gIGFycmF5LnNwbGljZShpbmRleCwgY291bnQsIGluc2VydCk7XG4gIHJldHVybiBhcnJheS5qb2luKCcnKTtcbn1cblxuLy8gaHR0cHM6Ly9zdGFja292ZXJmbG93LmNvbS9xdWVzdGlvbnMvODE1MjQyNi9ob3ctY2FuLWktY2FsY3VsYXRlLXRoZS1udW1iZXItb2YteWVhcnMtYmV0d2Vlbi10d28tZGF0ZXNcbmV4cG9ydCBmdW5jdGlvbiBjYWxjdWxhdGVBZ2UoYmlydGhkYXk6IERhdGUpOiBudW1iZXIge1xuICAvLyBiaXJ0aGRheSBpcyBhIGRhdGVcbiAgdmFyIGFnZURpZk1zID0gRGF0ZS5ub3coKSAtIGJpcnRoZGF5LmdldFRpbWUoKTtcbiAgdmFyIGFnZURhdGUgPSBuZXcgRGF0ZShhZ2VEaWZNcyk7IC8vIG1pbGlzZWNvbmRzIGZyb20gZXBvY2hcbiAgcmV0dXJuIE1hdGguYWJzKGFnZURhdGUuZ2V0VVRDRnVsbFllYXIoKSAtIDE5NzApO1xufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gY3VycmVudENvbmZpZygpOiBQcm9taXNlPENvbmZpZ0RhdGEgfCBudWxsPiB7XG4gIGxldCBjb25maWcgPSBhd2FpdCBnZXRDb25maWcoKTtcbiAgcmV0dXJuIGNvbmZpZztcbn1cblxuLyoqXG4gKiBHZXQgdGhlIGF3cyBzb2NrZXQgbWFuYWdlciB1c2VkIHRvIHNlbmQgbWVzc2FnZXMgb3ZlciBhIGdpdmVuIHdlYnNvY2tldCBnYXRld2F5XG4gKiBAcGFyYW0gZXZlbnRcbiAqIEByZXR1cm5zXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBnZXRNZ210KGV2ZW50OiBhbnkpOiBBV1MuQXBpR2F0ZXdheU1hbmFnZW1lbnRBcGkge1xuICBpZiAoYXBpZ3dNYW5hZ2VtZW50QXBpKSByZXR1cm4gYXBpZ3dNYW5hZ2VtZW50QXBpO1xuICBhcGlnd01hbmFnZW1lbnRBcGkgPSBuZXcgQVdTLkFwaUdhdGV3YXlNYW5hZ2VtZW50QXBpKHtcbiAgICBhcGlWZXJzaW9uOiAnMjAxOC0xMS0yOScsXG4gICAgZW5kcG9pbnQ6IGV2ZW50LnJlcXVlc3RDb250ZXh0LmRvbWFpbk5hbWUgKyAnLycgKyBldmVudC5yZXF1ZXN0Q29udGV4dC5zdGFnZSxcbiAgfSk7XG4gIHJldHVybiBhcGlnd01hbmFnZW1lbnRBcGk7XG59XG5cbi8qKlxuICogU2VuZCBhIG1lc3NhZ2UgdG8gYSBnaXZlbiBjb25uZWN0aW9uXG4gKiBAcGFyYW0ge3N0cmluZ30gdG9cbiAqIEBwYXJhbSB7c3RyaW5nfSBhY3Rpb25cbiAqIEBwYXJhbSB7b2JqZWN0fSBkYXRhXG4gKiBAcmV0dXJucyBib29sZWFuXG4gKi9cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBzZW5kTWVzc2FnZSh0bzogc3RyaW5nLCBhY3Rpb246IHN0cmluZywgZGF0YTogYW55KTogUHJvbWlzZTxib29sZWFuPiB7XG4gIGRhdGEuYWN0aW9uID0gYWN0aW9uO1xuICB0cnkge1xuICAgIGlmIChhcGlnd01hbmFnZW1lbnRBcGkpIHtcbiAgICAgIGF3YWl0IGFwaWd3TWFuYWdlbWVudEFwaVxuICAgICAgICAucG9zdFRvQ29ubmVjdGlvbih7XG4gICAgICAgICAgQ29ubmVjdGlvbklkOiB0byxcbiAgICAgICAgICBEYXRhOiBKU09OLnN0cmluZ2lmeShkYXRhKSxcbiAgICAgICAgfSlcbiAgICAgICAgLnByb21pc2UoKTtcbiAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cbiAgICByZXR1cm4gZmFsc2U7XG4gIH0gY2F0Y2ggKGUpIHtcbiAgICBjb25zb2xlLmxvZygnRXJyb3Igc2VuZGluZyBtZXNzYWdlICcsIGUpO1xuICAgIHJldHVybiBmYWxzZTtcbiAgfVxufVxuXG5leHBvcnQgZnVuY3Rpb24gZ2V0RGlzdGFuY2VGcm9tTGF0TG9uSW5LbShsYXQxOiBudW1iZXIsIGxvbjE6IG51bWJlciwgbGF0MjogbnVtYmVyLCBsb24yOiBudW1iZXIpOiBudW1iZXIge1xuICB2YXIgUiA9IDYzNzE7IC8vIFJhZGl1cyBvZiB0aGUgZWFydGggaW4ga21cbiAgdmFyIGRMYXQgPSBkZWcycmFkKGxhdDIgLSBsYXQxKTsgLy8gZGVnMnJhZCBiZWxvd1xuICB2YXIgZExvbiA9IGRlZzJyYWQobG9uMiAtIGxvbjEpO1xuICB2YXIgYSA9XG4gICAgTWF0aC5zaW4oZExhdCAvIDIpICogTWF0aC5zaW4oZExhdCAvIDIpICtcbiAgICBNYXRoLmNvcyhkZWcycmFkKGxhdDEpKSAqIE1hdGguY29zKGRlZzJyYWQobGF0MikpICogTWF0aC5zaW4oZExvbiAvIDIpICogTWF0aC5zaW4oZExvbiAvIDIpO1xuICB2YXIgYyA9IDIgKiBNYXRoLmF0YW4yKE1hdGguc3FydChhKSwgTWF0aC5zcXJ0KDEgLSBhKSk7XG4gIHZhciBkID0gUiAqIGM7IC8vIERpc3RhbmNlIGluIGttXG4gIHJldHVybiBkO1xufVxuXG5mdW5jdGlvbiBkZWcycmFkKGRlZzogbnVtYmVyKTogbnVtYmVyIHtcbiAgcmV0dXJuIGRlZyAqIChNYXRoLlBJIC8gMTgwKTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGRlY29kZUJvZHkoZXZlbnQ6IGFueSk6IHN0cmluZyB7XG4gIGxldCBib2R5UmF3ID0gZXZlbnQuYm9keTtcbiAgbGV0IGJvZHk6IHN0cmluZyA9IGV2ZW50LmJvZHk7XG4gIGxldCBib2R5SlNPTjogYW55O1xuICBpZiAoZXZlbnQuaXNCYXNlNjRFbmNvZGVkKSB7XG4gICAgYm9keSA9IEJ1ZmZlci5mcm9tKGJvZHlSYXcsICdiYXNlNjQnKS50b1N0cmluZygndXRmOCcpO1xuICB9XG4gIHRyeSB7XG4gICAgYm9keUpTT04gPSBKU09OLnBhcnNlKGJvZHkpO1xuICAgIHJldHVybiBib2R5SlNPTjtcbiAgfSBjYXRjaCB7XG4gICAgcmV0dXJuIGJvZHk7XG4gIH1cbn1cbmV4cG9ydCBmdW5jdGlvbiBtb250aE5hbWUobW9udGg6IG51bWJlcik6IHN0cmluZyB7XG4gIGxldCBtb250aHMgPSBbXG4gICAgJ0phbnVhcnknLFxuICAgICdGZWJydWFyeScsXG4gICAgJ01hcmNoJyxcbiAgICAnQXByaWwnLFxuICAgICdNYXknLFxuICAgICdKdW5lJyxcbiAgICAnSnVseScsXG4gICAgJ0F1Z3VzdCcsXG4gICAgJ1NlcHRlbWJlcicsXG4gICAgJ09jdG9iZXInLFxuICAgICdOb3ZlbWJlcicsXG4gICAgJ0RlY2VtYmVyJyxcbiAgXTtcbiAgaWYgKG1vbnRoIDwgMCB8fCBtb250aCA+IDExKSB0aHJvdyBuZXcgRXJyb3IoJ0ludmFsaWQgbW9udGggbnVtYmVyJyk7XG4gIHJldHVybiBtb250aHNbbW9udGhdO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gc2hvcnRNb250aE5hbWUobW9udGg6IG51bWJlcik6IHN0cmluZyB7XG4gIHJldHVybiBtb250aE5hbWUobW9udGgpLnN1YnN0cmluZygwLCAzKS50b1VwcGVyQ2FzZSgpO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gaW5qZWN0RGF0ZSh0ZXh0OiBzdHJpbmcpOiBzdHJpbmcge1xuICBmdW5jdGlvbiBwYWQobjogbnVtYmVyKTogc3RyaW5nIHtcbiAgICByZXR1cm4gbiA8IDEwID8gJzAnICsgbiA6ICcnICsgbjtcbiAgfVxuICBsZXQgdGltZU5vdyA9IG5ldyBEYXRlKCk7XG4gIHRleHQgPSB0ZXh0LnJlcGxhY2UoLyVzbS9nLCBzaG9ydE1vbnRoTmFtZSh0aW1lTm93LmdldE1vbnRoKCkpKTtcbiAgdGV4dCA9IHRleHQucmVwbGFjZSgvJWxtL2csIG1vbnRoTmFtZSh0aW1lTm93LmdldE1vbnRoKCkpKTtcbiAgdGV4dCA9IHRleHQucmVwbGFjZSgvJWQvZywgcGFkKHRpbWVOb3cuZ2V0RGF0ZSgpKSk7XG4gIHRleHQgPSB0ZXh0LnJlcGxhY2UoLyVtL2csIHBhZCh0aW1lTm93LmdldE1vbnRoKCkgKyAxKSk7XG4gIHRleHQgPSB0ZXh0LnJlcGxhY2UoLyV5L2csIHBhZCh0aW1lTm93LmdldEZ1bGxZZWFyKCkpKTtcbiAgdGV4dCA9IHRleHQucmVwbGFjZSgvJWgvZywgcGFkKHRpbWVOb3cuZ2V0SG91cnMoKSkpO1xuICB0ZXh0ID0gdGV4dC5yZXBsYWNlKC8lbi9nLCBwYWQodGltZU5vdy5nZXRNaW51dGVzKCkpKTtcbiAgdGV4dCA9IHRleHQucmVwbGFjZSgvJXMvZywgcGFkKHRpbWVOb3cuZ2V0U2Vjb25kcygpKSk7XG4gIHRleHQgPSB0ZXh0LnJlcGxhY2UoLyVsL2csIHBhZCh0aW1lTm93LmdldE1pbGxpc2Vjb25kcygpKSk7XG5cbiAgcmV0dXJuIHRleHQ7XG59XG5cbmV4cG9ydCBjb25zdCBnYXRld2F5ZXZlbnQgPSB7XG4gIHZlcnNpb246ICcyLjAnLFxuICByYXdRdWVyeVN0cmluZzogJycsXG4gIGhlYWRlcnM6IHtcbiAgICBhY2NlcHQ6ICcqLyonLFxuICAgICdhY2NlcHQtZW5jb2RpbmcnOiAnZ3ppcCxkZWZsYXRlLGJyJyxcbiAgICBhdXRob3JpemF0aW9uOlxuICAgICAgJ0JlYXJlciBleUpoYkdjaU9pSklVekkxTmlJc0luUjVjQ0k2SWtwWFZDSjkuZXlKcFpDSTZNVGc0T0N3aWFXRjBJam94TmpNMU5ETXlNelF4TENKbGVIQWlPakUyTXpnd01qUXpOREY5LlkwYUVZNVVaNmhKSmZLOXhxcUVXd0hyODRCTThqenFKMVBhdzZ6enU5R2cnLFxuICAgICdjb250ZW50LWxlbmd0aCc6ICc4ODUnLFxuICAgICdjb250ZW50LXR5cGUnOiAnYXBwbGljYXRpb24vand0JyxcbiAgICBob3N0OiAnMWRiNXdma3I5Zy5leGVjdXRlLWFwaS5ldS13ZXN0LTIuYW1hem9uYXdzLmNvbScsXG4gICAgJ3VzZXItYWdlbnQnOiAnbm9kZS1mZXRjaCcsXG4gICAgJ3gtYW16bi10cmFjZS1pZCc6ICdSb290PTEtNjE3YWJkMDQtMmE2OGU4Y2YwYmJmZjlhNDRjZjljODExJyxcbiAgICAneC1mb3J3YXJkZWQtZm9yJzogJzgyLjMxLjEuODgnLFxuICAgICd4LWZvcndhcmRlZC1wb3J0JzogJzQ0MycsXG4gICAgJ3gtZm9yd2FyZGVkLXByb3RvJzogJ2h0dHBzJyxcbiAgfSxcbiAgcmVxdWVzdENvbnRleHQ6IHtcbiAgICBhY2NvdW50SWQ6ICcwNzI0NDQzNTQ4MjgnLFxuICAgIGFwaUlkOiAnMWRiNXdma3I5ZycsXG4gICAgZG9tYWluTmFtZTogJzFkYjV3ZmtyOWcuZXhlY3V0ZS1hcGkuZXUtd2VzdC0yLmFtYXpvbmF3cy5jb20nLFxuICAgIGRvbWFpblByZWZpeDogJzFkYjV3ZmtyOWcnLFxuICAgIGh0dHA6IHtcbiAgICAgIG1ldGhvZDogJ1BPU1QnLFxuICAgICAgcGF0aDogJy9kZXYvY29pbnMvcHVyY2hhc2UnLFxuICAgICAgcHJvdG9jb2w6ICdIVFRQLzEuMScsXG4gICAgICBzb3VyY2VJcDogJzgyLjMxLjEuODgnLFxuICAgICAgdXNlckFnZW50OiAnbm9kZS1mZXRjaCcsXG4gICAgfSxcbiAgICBzdGFnZTogJ2RldicsXG4gICAgdGltZTogJzI4L09jdC8yMDIxOjE1OjA4OjUyICswMDAwJyxcbiAgICB0aW1lRXBvY2g6IDE2MzU0MzM3MzI5OTcsXG4gIH0sXG4gIGJvZHk6ICcnLFxuICBpc0Jhc2U2NEVuY29kZWQ6IGZhbHNlLFxufTtcblxuZXhwb3J0IHtnZXRDb25maWd9O1xuIl19